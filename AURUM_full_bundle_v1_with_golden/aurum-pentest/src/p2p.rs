use thiserror::Error;

#[derive(Debug, Error)]
pub enum P2pErr { #[error("truncated input")] Truncated, #[error("oversize input")] Oversize }

pub fn parse_len_prefixed(input: &[u8], max: usize) -> Result<(&[u8], &[u8]), P2pErr> {
    if input.len() < 4 { return Err(P2pErr::Truncated); }
    let len = u32::from_be_bytes([input[0],input[1],input[2],input[3]]) as usize;
    if len > max { return Err(P2pErr::Oversize); }
    if input.len().saturating_sub(4) < len { return Err(P2pErr::Truncated); }
    Ok((&input[4..4+len], &input[4+len..]))
}
